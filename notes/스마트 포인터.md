---
title: "스마트 포인터"
---


![](rust-container-cheat-sheet.svg)

## 포인터
메모리 주소를 담고 있는 변수. 이 주소로 다른 주소를 **가리키고**있기 때문에 포인터(*pointer*)라고 부른다.

흔히 **포인터**라고 콕 찝어 부를 때에는 아무 추상화가 없는 원시 포인터(*raw pointer*)를 의미한다. 러스트에서도 원시 포인터를 만들 수 있다. 불변은 `*const T`, 가변은 `*mut T`이다:

```rust
let num = 5;

let pointer: *const i32 = &num;
let pointer = &num as *const i32;

println!("{:?}", pointer);
// 0x16ee56ab4

let nullptr: *const i32 = std::ptr::null();
println!("{:?}", nullptr);
// 0x0
```

포인터는 **역참조**(*dereference*)로 비로소 유용해진다. 포인터가 담고 있는 주소에 찾아가 그 값을 얻거나 도로 대입할 수 있다. 역참조는 `*`[^1] 연산자로 한다. 다만 러스트에서는 원시 포인터를 바로 역참조할 수 없다. 원시 포인터가 러스트의 빌림 규칙을 무시할 수 있기 때문이다. `unsafe` 블록 내에서는 가능하다.

[^1]: 영어로는 /아스터리스크/라고 읽는다. 편하게 별표라고 읽자.

```rust
let mut num = 21;

let ptr = &mut num as *mut i32;

unsafe {
    // `ptr`이 가르키는 메모리 주소에 접근하여 대입하기
	*ptr *= 2;
	
    println!("{}", *ptr);
    // 42
}
```

## 참조자

포인터는 그대로 쓰기에는 위험성이 크기에 기능을 제약한 참조자를 주로 쓴다. 러스트에서는 빌림 규칙으로 포인터를 제약하고, `&T` 혹은 `&mut T`로 표기한다.

```rust
let mut num = 40;

// ref: &i32이다
let refer = &mut num;

// `&mut i32`에 `+=` 연산자를 적용할 수 없어서 아래 코드는 에러가 난다:
refer += 2;

// 역참조를 통해 `num`을 바꿀 수 있다.
*refer += 2;
println!("{}", num);
```

## 스마트 포인터란

포인터의 역할을 흉내내는 자료구조이다. 필요할 때 자동으로 값의 할당을 해제하는 등 자동으로 메모리 관리를 해주기 때문에 스마트 포인터라고 부른다.

- 역참조가 가능해야 한다. `Deref` 트레잇으로 구현한다.
- 할당을 해제할 수 있어야 한다. `Drop` 트레잇으로 구현한다.

## 스마트 포인터의 종류

![](assets/rust-memory-container-cs-1920x1080-light-back.png)
[usgai/rust-memory-container-cs](https://github.com/usagi/rust-memory-container-cs)

### Box\<T\>
- 힙에 자료를 할당할 때
- 컴파일 타임에 크기를 알 수 없을 때
- 소유권이 옮겨질 때 복사하고 싶지 않을 때
- 특정 트레잇을 구현한 타입들을 다루고 싶을 때

### Rc\<T\>
reference counting; 참조 카운팅. 단일 스레드에서 여러 소유권이 필요할 때 쓴다.

### RefCell\<T\>
소유권 검사를 컴파일 타임이 아닌 런타임으로 미루는 스마트 포인터. 실행시간에 안전한 것이 확인되었지만 컴파일 시간에 보장이 안 될 때 사용한다. 단일 스레드 환경에서 쓴다. `Rc<RefCell<T>>`의 형태로 다중 소유권과 내부 가변성을 한꺼번에 쓰기도 한다.

### Mutex\<T\>
mutual exclusion; 상호 배제.

### Arc\<T\>

## 참고

- [Rust container cheat sheet](https://docs.google.com/presentation/d/1q-c7UAyrUlM-eZyTo1pd8SZ0qwA_wYxmPZVOQkoDmH4/edit#slide=id.p)
- [GitHub - usagi/rust-memory-container-cs: Rust Memory Container Cheat-sheet](https://github.com/usagi/rust-memory-container-cs)